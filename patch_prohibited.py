import re

# Читаем app.py
with open('app.py', 'r', encoding='utf-8') as f:
    content = f.read()

# Находим и заменяем функцию get_gemini_response
old_function = '''def get_gemini_response(user_message, context=""):
    """Получает ответ от Gemini"""
    if not model:
        return " Сервис временно недоступен."
    
    try:
        prompt = f"""
Ты  умный ассистент компании PostPro Logistics. Помогаешь клиентам рассчитать стоимость доставки, отследить грузы и оформить заявки.

**Твои возможности:**
 Расчет стоимости доставки (нужен вес, товар, город, габариты)
 Отслеживание грузов по трек-номеру  
 Оформление заявок (нужны имя и телефон)
 Ответы на вопросы о тарифах, оплате, процедуре

**Важная информация:**
 Склады в Китае: Гуанчжоу и ИУ
 Оплата: пост-оплата при получении
 Сроки доставки до Алматы:
  - Из Гуанчжоу: 10-14 дней
  - Из ИУ: 7-10 дней
 Доставка по Казахстану: + до 4 дней
 Общий срок: от 7 до 18 дней в зависимости от склада и города назначения

Контекст: {context}

Сообщение клиента: {user_message}

Отвечай дружелюбно и профессионально! 
        '''
        
        response = model.generate_content(prompt)
        return response.text if response.text else "Не удалось обработать запрос."
        
    except Exception as e:
        logger.error(f"Ошибка Gemini: {e}")
        return " Произошла ошибка. Попробуйте еще раз."'''

new_function = '''def get_gemini_response(user_message, context=""):
    """Получает ответ от Gemini"""
    if not model:
        return " Сервис временно недоступен."
    
    try:
        prompt = f"""
Ты  умный ассистент компании PostPro Logistics. Помогаешь клиентам рассчитать стоимость доставки, отследить грузы и оформить заявки.

**Твои возможности:**
 Расчет стоимости доставки (нужен вес, товар, город, габариты)
 Отслеживание грузов по трек-номеру  
 Оформление заявок (нужны имя и телефон)
 Ответы на вопросы о тарифах, оплате, процедуре, запрещенных товарах

**Важная информация:**
 Склады в Китае: Гуанчжоу и ИУ
 Оплата: пост-оплата при получении
 Сроки доставки до Алматы:
  - Из Гуанчжоу: 10-14 дней
  - Из ИУ: 7-10 дней
 Доставка по Казахстану: + до 4 дней
 Общий срок: от 7 до 18 дней в зависимости от склада и города назначения

**Запрещенные к перевозке товары:**
 Опасные грузы: оружие, взрывчатки, легковоспламеняющиеся вещества
 Наркотики и психотропные вещества  
 Деньги, драгоценности, ценные бумаги
 Лекарства без сертификатов
 Алкоголь и табачные изделия
 Скоропортящиеся продукты
 Живые животные и растения
 Контрафактная продукция

 Уточняйте возможность перевозки у менеджера!

Контекст: {context}

Сообщение клиента: {user_message}

Отвечай дружелюбно и профессионально! Используй информацию о запрещенных товарах при ответах на соответствующие вопросы. 
        '''
        
        response = model.generate_content(prompt)
        return response.text if response.text else "Не удалось обработать запрос."
        
    except Exception as e:
        logger.error(f"Ошибка Gemini: {e}")
        return " Произошла ошибка. Попробуйте еще раз."'''

content = content.replace(old_function, new_function)

# Записываем обратно
with open('app.py', 'w', encoding='utf-8') as f:
    f.write(content)

print(" Информация о запрещенных товарах добавлена в app.py")
